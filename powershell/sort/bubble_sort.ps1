<#
.SYNOPSIS
    バブルソートモジュール

.DESCRIPTION
    このモジュールは、隣接する要素を比較・交換することで配列をソートする
    最も基本的なソートアルゴリズムであるバブルソートを実装しています。

    時間計算量: O(n²) - 常に全ての比較を行う
    空間計算量: O(1) - 追加のメモリをほとんど使用しない
    安定性: 安定（同じ値の要素の相対的な順序が保持される）
#>

function Sort-Bubble {
    <#
    .SYNOPSIS
        バブルソートを用いて配列を昇順にソートします。

    .DESCRIPTION
        バブルソートは最も基本的なソートアルゴリズムの一つです。
        隣接する要素を比較し、順序が逆であれば交換することを繰り返します。
        大きな要素が泡（バブル）のように配列の末尾に浮かび上がっていく様子から
        この名前がつけられました。

        アルゴリズムの手順:
        1. 配列の先頭から、隣接する2つの要素を比較
        2. 左の要素が右の要素より大きければ交換
        3. 配列の末尾まで繰り返す（1パス完了）
        4. 最大の要素が末尾に移動している
        5. 残りの要素に対して1-4を繰り返す

    .PARAMETER InputObject
        ソート対象の配列

    .OUTPUTS
        [object[]] ソートされた配列（元の配列のコピー）

    .EXAMPLE
        Sort-Bubble -InputObject @(64, 34, 25, 12, 22, 11, 90)
        # 出力: @(11, 12, 22, 25, 34, 64, 90)
    #>
    param (
        [Parameter(Mandatory=$true, ValueFromPipeline=$true)]
        [AllowEmptyCollection()]
        [object[]]$InputObject
    )

    # 配列のコピーを作成（元の配列を変更しないため）
    # Clone() メソッドで浅いコピーを作成
    $array = $InputObject.Clone()
    $n = $array.Count

    # 要素が1つ以下の場合は既にソート済み
    if ($n -le 1) {
        return $array
    }

    # 外側のループ: $n回繰り返す
    # 各イテレーションで、未ソート部分の最大値が正しい位置に移動する
    for ($i = 0; $i -lt $n; $i++) {
        # 内側のループ: 隣接する要素を比較・交換
        # $n - $i - 1 までの理由: 
        # - 各パスで最大値が末尾に移動するため、末尾の$i個はソート済み
        # - $j+1 にアクセスするため、範囲を1つ減らす
        for ($j = 0; $j -lt $n - $i - 1; $j++) {
            # 隣接する要素を比較
            if ($array[$j] -gt $array[$j + 1]) {
                # 左の要素が右より大きければ交換
                # 一時変数を使った要素の交換
                $temp = $array[$j]
                $array[$j] = $array[$j + 1]
                $array[$j + 1] = $temp
            }
        }
    }

    # ソート済みの配列を返す
    # PowerShellで配列を正しく返すために、カンマ演算子を使用
    return ,$array
}
